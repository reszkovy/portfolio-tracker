<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Portfolio Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
<script>
if(!sessionStorage.getItem('auth')){
  let p=prompt('Enter password:');
  if(p!=='Dupsko69'){
    document.body.innerHTML='<h1 style="text-align:center;margin-top:50px;color:red;">Access Denied</h1>';
    throw new Error('Access denied');
  }
  sessionStorage.setItem('auth','true');
}
</script>
<div class="container mx-auto px-4 py-8 max-w-4xl">
<h1 class="text-3xl font-bold text-center mb-8">Portfolio Tracker</h1>
<div class="grid grid-cols-3 gap-4 mb-6">
<div id="tvCard" class="bg-blue-500 text-white rounded-lg p-4">
<p class="text-sm opacity-80">Total Value</p>
<p id="totalValue" class="text-2xl font-bold">$0</p>
</div>
<div id="pnlCard" class="bg-green-500 text-white rounded-lg p-4">
<p class="text-sm opacity-80">P&L</p>
<p id="totalPnl" class="text-2xl font-bold">$0</p>
</div>
<div class="bg-purple-500 text-white rounded-lg p-4">
<p class="text-sm opacity-80">Positions</p>
<p id="posCount" class="text-2xl font-bold">0</p>
</div>
</div>
<div class="bg-white rounded-lg shadow p-4 mb-6">
<div class="flex justify-between items-center mb-4">
<h2 class="text-lg font-semibold">Positions</h2>
<button onclick="addPosition()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">+ Add</button>
</div>
<div id="positions" class="space-y-2"></div>
</div>
<div class="bg-white rounded-lg shadow p-4">
<h2 class="text-lg font-semibold mb-4">Allocation</h2>
<canvas id="chart" height="200"></canvas>
</div>
</div>
<script>
let positions=JSON.parse(localStorage.getItem('positions')||'[{"ticker":"GOOGL","type":"stock","shares":30,"cost":175,"price":178},{"ticker":"BTC","type":"crypto","shares":0.827,"cost":95000,"price":97500}]');
let chart;
function save(){localStorage.setItem('positions',JSON.stringify(positions));render();}
function render(){
let tv=0,tc=0;
positions.forEach(p=>{tv+=p.shares*p.price;tc+=p.shares*p.cost;});
document.getElementById('totalValue').textContent='$'+tv.toLocaleString(undefined,{maximumFractionDigits:0});
let pnl=tv-tc;
document.getElementById('totalPnl').textContent=(pnl>=0?'+':'')+pnl.toLocaleString(undefined,{maximumFractionDigits:0});
document.getElementById('pnlCard').className='text-white rounded-lg p-4 '+(pnl>=0?'bg-green-500':'bg-red-500');
document.getElementById('posCount').textContent=positions.length;
let html='';
positions.forEach((p,i)=>{
let val=p.shares*p.price;let cost=p.shares*p.cost;let pl=val-cost;let plPct=cost>0?((pl/cost)*100).toFixed(1):0;
html+='<div class="flex items-center justify-between p-3 bg-gray-50 rounded"><div class="flex-1"><span class="font-semibold">'+p.ticker+'</span><span class="text-xs text-gray-500 ml-2">'+p.type+'</span></div><div class="text-right mr-4"><p class="font-medium">$'+val.toLocaleString(undefined,{maximumFractionDigits:0})+'</p><p class="text-sm '+(pl>=0?'text-green-600':'text-red-600')+'">'+(pl>=0?'+':'')+'$'+pl.toLocaleString(undefined,{maximumFractionDigits:0})+' ('+plPct+'%)</p></div><div class="flex gap-2"><button onclick="editPos('+i+')" class="text-blue-500 hover:text-blue-700">Edit</button><button onclick="delPos('+i+')" class="text-red-500 hover:text-red-700">Del</button></div></div>';
});
document.getElementById('positions').innerHTML=html||'<p class="text-gray-500 text-center py-4">No positions yet</p>';
renderChart();
}
function renderChart(){
let labels=positions.map(p=>p.ticker);let data=positions.map(p=>p.shares*p.price);
let colors=['#3B82F6','#F59E0B','#10B981','#EF4444','#8B5CF6','#EC4899','#06B6D4','#84CC16'];
if(chart)chart.destroy();
chart=new Chart(document.getElementById('chart'),{type:'doughnut',data:{labels,datasets:[{data,backgroundColor:colors.slice(0,data.length)}]},options:{plugins:{legend:{position:'right'}}}});
}
function addPosition(){
let ticker=prompt('Ticker (e.g. AAPL, BTC):');if(!ticker)return;
let type=prompt('Type (stock/crypto/forex):','stock');
let shares=parseFloat(prompt('Quantity:'));
let cost=parseFloat(prompt('Cost per unit:'));
let price=parseFloat(prompt('Current price:',cost));
if(ticker&&!isNaN(shares)&&!isNaN(cost)){positions.push({ticker:ticker.toUpperCase(),type,shares,cost,price});save();}
}
function editPos(i){let p=positions[i];let price=parseFloat(prompt('New price for '+p.ticker+':',p.price));if(!isNaN(price)){p.price=price;save();}}
function delPos(i){if(confirm('Delete '+positions[i].ticker+'?')){positions.splice(i,1);save();}}
render();
</script>
</body>
</html>
